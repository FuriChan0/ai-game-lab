<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞—Å—å—è–Ω—Å –ö–æ—Å—ã–Ω–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, transform 0.3s;
        }
        
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background-color: #f5f5dc;
            color: #556b2f;
            overflow-x: hidden;
        }
        
        body.dark-theme {
            background-color: #2c3e50;
            color: #ecf0f1;
        }
        
        .container {
            background-color: #f0e68c;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: auto;
            max-width: 95vw;
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 5;
        }
        
        body.dark-theme .container {
            background-color: #34495e;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 28px;
            color: #6b8e23;
            transition: transform 0.3s;
        }
        
        h1:hover {
            transform: scale(1.05);
        }
        
        body.dark-theme h1 {
            color: #27ae60;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            background-color: #faf0e6;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
            transition: transform 0.3s;
        }
        
        .game-info:hover {
            transform: translateY(-2px);
        }
        
        body.dark-theme .game-info {
            background-color: #2c3e50;
        }
        
        .moves, .timer {
            font-size: 18px;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            position: relative;
            z-index: 10;
        }
        
        button {
            background-color: #deb887;
            border: none;
            color: #556b2f;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 1;
            }
            20% {
                transform: scale(20, 20);
                opacity: 1;
            }
            100% {
                transform: scale(50, 50);
                opacity: 0;
            }
        }
        
        button:hover {
            background-color: #bdb76b;
            transform: translateY(-2px);
        }
        
        body.dark-theme button {
            background-color: #3498db;
            color: #ecf0f1;
        }
        
        .game-area {
            width: 100%;
            min-height: 500px;
            position: relative;
            margin-bottom: 40px;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin: 0 auto;
            width: 100%;
            justify-content: center;
        }
        
        .foundation, .tableau, .stock, .waste {
            min-height: 120px;
            background-color: rgba(245, 245, 220, 0.5);
            border-radius: 5px;
            border: 2px dashed #bdb76b;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        body.dark-theme .foundation, 
        body.dark-theme .tableau, 
        body.dark-theme .stock, 
        body.dark-theme .waste {
            background-color: rgba(44, 62, 80, 0.5);
            border-color: #3498db;
        }
        
        .card {
            width: 80px;
            height: 120px;
            background-color: #faf0e6;
            border-radius: 5px;
            border: 1px solid #bdb76b;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            position: absolute;
            cursor: grab;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .card.dragging {
            cursor: grabbing;
            z-index: 1000;
            transform: rotate(3deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            opacity: 0.7;
        }
        
        .card.dragging-source {
            opacity: 0.3;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .card.red {
            color: #c44;
        }
        
        .card.black {
            color: #2c3e50;
        }
        
        body.dark-theme .card {
            background-color: #2c3e50;
            border-color: #3498db;
        }
        
        body.dark-theme .card.red {
            color: #e74c3c;
        }
        
        body.dark-theme .card.black {
            color: #ecf0f1;
        }
        
        .card-value {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }
        
        .card-suit {
            font-size: 24px;
            text-align: center;
        }
        
        .card-top, .card-bottom {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .card-bottom {
            align-items: flex-end;
            transform: rotate(180deg);
        }
        
        .card-back {
            background: repeating-linear-gradient(
                45deg,
                #6b8e23,
                #6b8e23 10px,
                #556b2f 10px,
                #556b2f 20px
            );
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
        }
        
        body.dark-theme .card-back {
            background: repeating-linear-gradient(
                45deg,
                #27ae60,
                #27ae60 10px,
                #2c3e50 10px,
                #2c3e50 20px
            );
        }
        
        .tableau .card {
            margin-top: 30px;
        }
        
        .tableau .card:first-child {
            margin-top: 0;
        }
        
        .game-status {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
            transition: all 0.3s;
            position: relative;
            z-index: 10;
        }
        
        .win {
            color: #27ae60;
            animation: win 1s infinite alternate;
        }
        
        @keyframes win {
            from {
                transform: scale(1);
            }
            to {
                transform: scale(1.1);
            }
        }
        
        .instructions {
            margin-top: 30px;
            text-align: center;
            color: #6b8e23;
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
            z-index: 10;
            padding: 10px;
            background-color: rgba(245, 245, 220, 0.8);
            border-radius: 5px;
            width: 100%;
        }
        
        body.dark-theme .instructions {
            color: #bdc3c7;
            background-color: rgba(44, 62, 80, 0.8);
        }
        
        .theme-toggle {
            margin-top: 20px;
            background: none;
            border: 2px solid #bdb76b;
            color: #556b2f;
            padding: 5px 10px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
            z-index: 10;
        }
        
        body.dark-theme .theme-toggle {
            border-color: #3498db;
            color: #ecf0f1;
        }
        
        .theme-icon {
            transition: transform 0.5s;
        }
        
        .theme-toggle:hover .theme-icon {
            transform: rotate(180deg);
        }
        
        .card-placeholder {
            width: 80px;
            height: 120px;
            border: 2px dashed #bdb76b;
            border-radius: 5px;
            opacity: 0.5;
        }
        
        body.dark-theme .card-placeholder {
            border-color: #3498db;
        }
        
        @media (max-width: 1200px) {
            .card {
                width: 70px;
                height: 105px;
            }
            
            .card-value {
                font-size: 18px;
            }
            
            .card-suit {
                font-size: 20px;
            }
            
            .card-placeholder {
                width: 70px;
                height: 105px;
            }
        }
        
        @media (max-width: 900px) {
            .card {
                width: 60px;
                height: 90px;
            }
            
            .card-value {
                font-size: 16px;
            }
            
            .card-suit {
                font-size: 18px;
            }
            
            .card-placeholder {
                width: 60px;
                height: 90px;
            }
            
            .foundation, .tableau, .stock, .waste {
                min-height: 100px;
            }
            
            .game-area {
                min-height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            
            .container {
                padding: 15px;
            }
        }
        
        @media (max-width: 600px) {
            .card {
                width: 50px;
                height: 75px;
            }
            
            .card-value {
                font-size: 14px;
            }
            
            .card-suit {
                font-size: 16px;
            }
            
            .card-placeholder {
                width: 50px;
                height: 75px;
            }
            
            .foundation, .tableau, .stock, .waste {
                min-height: 80px;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .game-area {
                min-height: 350px;
                margin-bottom: 30px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                margin-bottom: 5px;
            }
        }
        
        .drop-target {
            box-shadow: 0 0 10px rgba(107, 142, 35, 0.8);
        }
        
        body.dark-theme .drop-target {
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ü–ê–°–¨–Ø–ù–° –ö–û–°–´–ù–ö–ê</h1>
        
        <div class="game-info">
            <div class="moves">–•–æ–¥—ã: <span id="moves-count">0</span></div>
            <div class="timer">–í—Ä–µ–º—è: <span id="time">0</span></div>
        </div>
        
        <div class="controls">
            <button id="new-game-btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
        
        <div class="game-area">
            <div class="game-board" id="game-board">
                <!-- –°—Ç–æ–∫ –∏ —Å–±—Ä–æ—Å -->
                <div class="stock" id="stock"></div>
                <div class="waste" id="waste"></div>
                <div class="card-placeholder"></div>
                
                <!-- –§—É–Ω–¥–∞–º–µ–Ω—Ç—ã -->
                <div class="foundation" id="foundation-0"></div>
                <div class="foundation" id="foundation-1"></div>
                <div class="foundation" id="foundation-2"></div>
                <div class="foundation" id="foundation-3"></div>
                
                <!-- –ò–≥—Ä–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã -->
                <div class="tableau" id="tableau-0"></div>
                <div class="tableau" id="tableau-1"></div>
                <div class="tableau" id="tableau-2"></div>
                <div class="tableau" id="tableau-3"></div>
                <div class="tableau" id="tableau-4"></div>
                <div class="tableau" id="tableau-5"></div>
                <div class="tableau" id="tableau-6"></div>
            </div>
        </div>
        
        <div class="game-status" id="game-status"></div>
        
        <div class="instructions">
            –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç–æ–∫, —á—Ç–æ–±—ã –≤–∑—è—Ç—å –∫–∞—Ä—Ç—ã. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç—ã –º–µ–∂–¥—É —Å—Ç–æ–ª–±—Ü–∞–º–∏ –∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–º–∏.
        </div>
        
        <button class="theme-toggle" id="theme-toggle">
            <span class="theme-icon">üåì</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
        </button>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
        const SUITS = ['hearts', 'diamonds', 'clubs', 'spades'];
        const VALUES = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            deck: [],
            stock: [],
            waste: [],
            foundations: [[], [], [], []],
            tableau: [[], [], [], [], [], [], []],
            moves: 0,
            startTime: null,
            timerInterval: null,
            theme: 'light',
            draggingCard: null,
            dragOffset: { x: 0, y: 0 },
            draggingStack: []
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const movesCountElement = document.getElementById('moves-count');
        const timeElement = document.getElementById('time');
        const gameStatusElement = document.getElementById('game-status');
        const newGameButton = document.getElementById('new-game-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            clearInterval(gameState.timerInterval);
            
            gameState.deck = createDeck();
            gameState.stock = [];
            gameState.waste = [];
            gameState.foundations = [[], [], [], []];
            gameState.tableau = [[], [], [], [], [], [], []];
            gameState.moves = 0;
            gameState.startTime = null;
            gameState.draggingCard = null;
            gameState.draggingStack = [];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            movesCountElement.textContent = '0';
            timeElement.textContent = '0';
            gameStatusElement.textContent = '';
            gameStatusElement.classList.remove('win');
            
            // –û—á–∏—â–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
            document.querySelectorAll('.stock, .waste, .foundation, .tableau').forEach(container => {
                container.innerHTML = '';
            });
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–æ–ª–æ–¥—É
            shuffleDeck(gameState.deck);
            
            // –†–∞–∑–¥–∞–µ–º –∫–∞—Ä—Ç—ã –Ω–∞ –∏–≥—Ä–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã
            dealCards();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–∞—Ä—Ç—ã –≤ —Å—Ç–æ–∫
            gameState.stock = [...gameState.deck];
            updateStockView();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            addEventListeners();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function createDeck() {
            const deck = [];
            
            for (const suit of SUITS) {
                for (const value of VALUES) {
                    deck.push({
                        suit,
                        value,
                        color: (suit === 'hearts' || suit === 'diamonds') ? 'red' : 'black',
                        isFaceUp: false
                    });
                }
            }
            
            return deck;
        }
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        // –†–∞–∑–¥–∞—á–∞ –∫–∞—Ä—Ç
        function dealCards() {
            let cardIndex = 0;
            
            for (let i = 0; i < 7; i++) {
                for (let j = i; j < 7; j++) {
                    const card = gameState.deck[cardIndex++];
                    // –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–∞—Ä—Ç–∞ –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ –æ—Ç–∫—Ä—ã—Ç–∞
                    card.isFaceUp = (j === i);
                    gameState.tableau[j].push(card);
                }
            }
            
            // –£–¥–∞–ª—è–µ–º —Ä–∞–∑–¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–ª–æ–¥—ã
            gameState.deck.splice(0, cardIndex);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
            updateTableView();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç–æ–∫–∞
        function updateStockView() {
            const stockElement = document.getElementById('stock');
            stockElement.innerHTML = '';
            
            if (gameState.stock.length > 0) {
                const cardElement = createCardElement({}, true);
                stockElement.appendChild(cardElement);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç–æ–∫
                cardElement.addEventListener('click', () => {
                    if (gameState.startTime === null) {
                        gameState.startTime = Date.now();
                        startTimer();
                    }
                    
                    drawCards();
                });
            } else if (gameState.waste.length > 0) {
                // –ï—Å–ª–∏ —Å—Ç–æ–∫ –ø—É—Å—Ç, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç—ã –≤ —Å–±—Ä–æ—Å–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞
                const cardElement = createCardElement({}, true);
                cardElement.textContent = 'üîÑ';
                stockElement.appendChild(cardElement);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–æ–ª–æ–¥—ã
                cardElement.addEventListener('click', () => {
                    resetStock();
                });
            }
        }
        
        // –í–∑—è—Ç–∏–µ –∫–∞—Ä—Ç –∏–∑ —Å—Ç–æ–∫–∞
        function drawCards() {
            if (gameState.stock.length === 0) {
                return; // –ù–µ—á–µ–≥–æ –±—Ä–∞—Ç—å
            }
            
            // –ë–µ—Ä–µ–º —Ç—Ä–∏ –∫–∞—Ä—Ç—ã –∏–∑ —Å—Ç–æ–∫–∞ (–∏–ª–∏ –º–µ–Ω—å—à–µ, –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω—å—à–µ —Ç—Ä–µ—Ö)
            const drawCount = Math.min(3, gameState.stock.length);
            const drawnCards = gameState.stock.splice(-drawCount, drawCount);
            
            // –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–±—Ä–æ—Å
            drawnCards.forEach(card => {
                card.isFaceUp = true;
                gameState.waste.push(card);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            updateStockView();
            updateWasteView();
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ö–æ–¥–æ–≤
            gameState.moves++;
            movesCountElement.textContent = gameState.moves;
        }
        
        // –°–±—Ä–æ—Å —Å—Ç–æ–∫–∞ - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Ä—Ç—ã –∏–∑ —Å–±—Ä–æ—Å–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç–æ–∫
        function resetStock() {
            if (gameState.waste.length === 0) {
                return; // –ù–µ—á–µ–≥–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å
            }
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç—ã –∏–∑ —Å–±—Ä–æ—Å–∞ –≤ —Å—Ç–æ–∫
            gameState.stock = [...gameState.waste.reverse()];
            gameState.waste = [];
            
            // –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã –≤ —Å—Ç–æ–∫–µ —Ä—É–±–∞—à–∫–æ–π –≤–≤–µ—Ä—Ö
            gameState.stock.forEach(card => card.isFaceUp = false);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            updateStockView();
            updateWasteView();
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ö–æ–¥–æ–≤
            gameState.moves++;
            movesCountElement.textContent = gameState.moves;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–±—Ä–æ—Å–∞
        function updateWasteView() {
            const wasteElement = document.getElementById('waste');
            wasteElement.innerHTML = '';
            
            if (gameState.waste.length > 0) {
                const topCard = gameState.waste[gameState.waste.length - 1];
                const cardElement = createCardElement(topCard);
                wasteElement.appendChild(cardElement);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞—Ä—Ç—ã
                addCardEventListeners(cardElement, topCard, 'waste');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
        function updateTableView() {
            for (let i = 0; i < 7; i++) {
                const tableauElement = document.getElementById(`tableau-${i}`);
                tableauElement.innerHTML = '';
                
                gameState.tableau[i].forEach((card, index) => {
                    const cardElement = createCardElement(card);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞—Ä—Ç—ã –≤ —Å—Ç–æ–ª–±—Ü–µ
                    cardElement.style.top = `${index * 30}px`;
                    
                    tableauElement.appendChild(cardElement);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞—Ä—Ç—ã
                    if (card.isFaceUp) {
                        addCardEventListeners(cardElement, card, 'tableau', i, index);
                    }
                });
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–≤
        function updateFoundationsView() {
            for (let i = 0; i < 4; i++) {
                const foundationElement = document.getElementById(`foundation-${i}`);
                foundationElement.innerHTML = '';
                
                if (gameState.foundations[i].length > 0) {
                    const topCard = gameState.foundations[i][gameState.foundations[i].length - 1];
                    const cardElement = createCardElement(topCard);
                    foundationElement.appendChild(cardElement);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞—Ä—Ç—ã
                    addCardEventListeners(cardElement, topCard, 'foundation', i);
                }
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–∞—Ä—Ç—ã
        function createCardElement(card, isBack = false) {
            const cardElement = document.createElement('div');
            cardElement.className = `card ${isBack ? 'card-back' : ''}`;
            
            if (!isBack) {
                cardElement.classList.add(card.color);
                
                const topElement = document.createElement('div');
                topElement.className = 'card-top';
                
                const valueElement = document.createElement('div');
                valueElement.className = 'card-value';
                valueElement.textContent = card.value;
                
                const suitElement = document.createElement('div');
                suitElement.className = 'card-suit';
                suitElement.textContent = getSuitSymbol(card.suit);
                
                topElement.appendChild(valueElement);
                topElement.appendChild(suitElement);
                
                const bottomElement = document.createElement('div');
                bottomElement.className = 'card-bottom';
                
                const valueElement2 = document.createElement('div');
                valueElement2.className = 'card-value';
                valueElement2.textContent = card.value;
                
                const suitElement2 = document.createElement('div');
                suitElement2.className = 'card-suit';
                suitElement2.textContent = getSuitSymbol(card.suit);
                
                bottomElement.appendChild(valueElement2);
                bottomElement.appendChild(suitElement2);
                
                cardElement.appendChild(topElement);
                cardElement.appendChild(bottomElement);
            } else {
                cardElement.textContent = 'üé¥';
            }
            
            return cardElement;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –º–∞—Å—Ç–∏
        function getSuitSymbol(suit) {
            switch (suit) {
                case 'hearts': return '‚ô•';
                case 'diamonds': return '‚ô¶';
                case 'clubs': return '‚ô£';
                case 'spades': return '‚ô†';
                default: return '';
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞—Ä—Ç—ã
        function addCardEventListeners(cardElement, card, sourceType, sourceIndex = null, cardIndex = null) {
            cardElement.addEventListener('mousedown', (e) => {
                if (gameState.startTime === null) {
                    gameState.startTime = Date.now();
                    startTimer();
                }
                
                startDragging(cardElement, card, sourceType, sourceIndex, cardIndex, e);
                e.preventDefault();
            });
        }
        
        // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
        function startDragging(cardElement, card, sourceType, sourceIndex, cardIndex, e) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–æ–ø–∫—É –∫–∞—Ä—Ç –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            let cardsToDrag = [];
            
            if (sourceType === 'tableau') {
                // –î–ª—è tableau –±–µ—Ä–µ–º –≤—Å–µ –∫–∞—Ä—Ç—ã –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç–æ–ª–±—Ü–∞
                cardsToDrag = gameState.tableau[sourceIndex].slice(cardIndex);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∫–∞—Ä—Ç—ã –≤ —Å—Ç–æ–ø–∫–µ –æ–±—Ä–∞–∑—É—é—Ç –≤–∞–ª–∏–¥–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                for (let i = 1; i < cardsToDrag.length; i++) {
                    const prevCard = cardsToDrag[i - 1];
                    const currCard = cardsToDrag[i];
                    
                    if (prevCard.color === currCard.color || 
                        getCardValue(currCard.value) !== getCardValue(prevCard.value) - 1) {
                        // –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ —ç—Ç–æ–π –∫–∞—Ä—Ç—ã
                        cardsToDrag = cardsToDrag.slice(0, i);
                        break;
                    }
                }
                
                // –ü–æ–º–µ—á–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç—ã –≤ —Å—Ç–æ–ø–∫–µ –∫–∞–∫ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–µ
                const tableauElement = document.getElementById(`tableau-${sourceIndex}`);
                const cardElements = tableauElement.querySelectorAll('.card');
                for (let i = cardIndex; i < cardIndex + cardsToDrag.length; i++) {
                    if (cardElements[i]) {
                        cardElements[i].classList.add('dragging-source');
                    }
                }
            } else {
                // –î–ª—è waste –∏ foundation –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–∞—Ä—Ç—É
                cardsToDrag = [card];
                cardElement.classList.add('dragging-source');
            }
            
            gameState.draggingStack = cardsToDrag;
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            const dragElement = createCardElement(card);
            dragElement.classList.add('dragging');
            dragElement.style.position = 'fixed';
            dragElement.style.left = `${e.clientX - 40}px`;
            dragElement.style.top = `${e.clientY - 60}px`;
            dragElement.style.width = `${cardElement.offsetWidth}px`;
            dragElement.style.height = `${cardElement.offsetHeight}px`;
            dragElement.style.margin = '0';
            dragElement.style.zIndex = '1000';
            
            document.body.appendChild(dragElement);
            
            gameState.draggingCard = {
                element: dragElement,
                card,
                sourceType,
                sourceIndex,
                cardIndex,
                cards: cardsToDrag
            };
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞—Ä—Ç—ã
            const rect = cardElement.getBoundingClientRect();
            gameState.dragOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('mouseup', handleDragEnd);
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ü–µ–ª–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            highlightDropTargets(card);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
        function handleDragMove(e) {
            if (!gameState.draggingCard) return;
            
            const dragElement = gameState.draggingCard.element;
            dragElement.style.left = `${e.clientX - gameState.dragOffset.x}px`;
            dragElement.style.top = `${e.clientY - gameState.dragOffset.y}px`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–¥ –∫–∞–∫–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫—É—Ä—Å–æ—Ä
            const elements = document.elementsFromPoint(e.clientX, e.clientY);
            let dropTarget = null;
            let dropTargetType = null;
            
            for (const element of elements) {
                if (element.classList.contains('tableau')) {
                    dropTarget = element;
                    dropTargetType = 'tableau';
                    break;
                } else if (element.classList.contains('foundation')) {
                    dropTarget = element;
                    dropTargetType = 'foundation';
                    break;
                } else if (element.classList.contains('card')) {
                    // –ï—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –Ω–∞–¥ –∫–∞—Ä—Ç–æ–π, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    const container = element.closest('.tableau, .foundation');
                    if (container) {
                        dropTarget = container;
                        dropTargetType = container.classList.contains('tableau') ? 'tableau' : 'foundation';
                        break;
                    }
                }
            }
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.tableau, .foundation').forEach(el => {
                el.classList.remove('drop-target');
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –æ–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç
            if (dropTarget && isValidDropTarget(dropTarget, dropTargetType)) {
                dropTarget.classList.add('drop-target');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function handleDragEnd(e) {
            if (!gameState.draggingCard) return;
            
            // –£–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            gameState.draggingCard.element.remove();
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.tableau, .foundation').forEach(el => {
                el.classList.remove('drop-target');
            });
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–º–µ—Ç–∫—É –æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ —Å –∏—Å—Ö–æ–¥–Ω—ã—Ö –∫–∞—Ä—Ç
            document.querySelectorAll('.dragging-source').forEach(el => {
                el.classList.remove('dragging-source');
            });
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω–∞–¥ –∫–∞–∫–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –±—ã–ª–∞ –æ—Ç–ø—É—â–µ–Ω–∞ –∫–∞—Ä—Ç–∞
            const elements = document.elementsFromPoint(e.clientX, e.clientY);
            let targetElement = null;
            let targetType = null;
            let targetIndex = null;
            
            for (const element of elements) {
                if (element.classList.contains('tableau')) {
                    targetElement = element;
                    targetType = 'tableau';
                    targetIndex = parseInt(element.id.split('-')[1]);
                    break;
                } else if (element.classList.contains('foundation')) {
                    targetElement = element;
                    targetType = 'foundation';
                    targetIndex = parseInt(element.id.split('-')[1]);
                    break;
                } else if (element.classList.contains('card')) {
                    // –ï—Å–ª–∏ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –Ω–∞–¥ –∫–∞—Ä—Ç–æ–π, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    const container = element.closest('.tableau, .foundation');
                    if (container) {
                        targetElement = container;
                        targetType = container.classList.contains('tableau') ? 'tableau' : 'foundation';
                        targetIndex = parseInt(container.id.split('-')[1]);
                        break;
                    }
                }
            }
            
            if (targetElement && targetType) {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É
                moveCard(gameState.draggingCard, targetType, targetIndex);
            }
            
            // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.removeEventListener('mousemove', handleDragMove);
            document.removeEventListener('mouseup', handleDragEnd);
            
            gameState.draggingCard = null;
            gameState.draggingStack = [];
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –¥–æ–ø—É—Å—Ç–∏–º–æ–π —Ü–µ–ª—å—é –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function isValidDropTarget(targetElement, targetType) {
            if (!gameState.draggingCard) return false;
            
            const card = gameState.draggingCard.cards[0]; // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç—É –≤ —Å—Ç–æ–ø–∫–µ
            
            if (targetType === 'tableau') {
                const targetIndex = parseInt(targetElement.id.split('-')[1]);
                
                if (gameState.tableau[targetIndex].length === 0) {
                    // –ú–æ–∂–Ω–æ –∫–ª–∞—Å—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ–ª—è –Ω–∞ –ø—É—Å—Ç–æ–π —Å—Ç–æ–ª–±–µ—Ü
                    return card.value === 'K';
                } else {
                    const topCard = gameState.tableau[targetIndex][gameState.tableau[targetIndex].length - 1];
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π
                    return topCard.color !== card.color && 
                           getCardValue(topCard.value) === getCardValue(card.value) + 1;
                }
            } else if (targetType === 'foundation') {
                const targetIndex = parseInt(targetElement.id.split('-')[1]);
                
                if (gameState.foundations[targetIndex].length === 0) {
                    // –ú–æ–∂–Ω–æ –∫–ª–∞—Å—Ç—å —Ç–æ–ª—å–∫–æ —Ç—É–∑–∞ –Ω–∞ –ø—É—Å—Ç–æ–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç
                    return card.value === 'A';
                } else {
                    const topCard = gameState.foundations[targetIndex][gameState.foundations[targetIndex].length - 1];
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –º–∞—Å—Ç—å –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π
                    return topCard.suit === card.suit && 
                           getCardValue(topCard.value) === getCardValue(card.value) - 1;
                }
            }
            
            return false;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
        function getCardValue(value) {
            const values = {
                'A': 1, '2': 2, '3': 3, '4': 4, '5': 5, 
                '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 
                'J': 11, 'Q': 12, 'K': 13
            };
            return values[value];
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ü–µ–ª–µ–π –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function highlightDropTargets(card) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–±—Ü—ã
            for (let i = 0; i < 7; i++) {
                const tableau = document.getElementById(`tableau-${i}`);
                if (isValidDropTarget(tableau, 'tableau')) {
                    tableau.classList.add('drop-target');
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç—ã
            for (let i = 0; i < 4; i++) {
                const foundation = document.getElementById(`foundation-${i}`);
                if (isValidDropTarget(foundation, 'foundation')) {
                    foundation.classList.add('drop-target');
                }
            }
        }
        
        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
        function moveCard(draggingCard, targetType, targetIndex) {
            let moved = false;
            const { sourceType, sourceIndex, cardIndex, cards } = draggingCard;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ–ø—É—Å—Ç–∏–º –ª–∏ —Ö–æ–¥
            const targetElement = document.getElementById(`${targetType}-${targetIndex}`);
            if (!isValidDropTarget(targetElement, targetType)) {
                return false;
            }
            
            if (sourceType === 'tableau' && targetType === 'tableau') {
                // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç–æ–ª–±—Ü–∞–º–∏
                if (sourceIndex !== targetIndex) {
                    // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç—ã –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞
                    gameState.tableau[sourceIndex].splice(cardIndex, cards.length);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—ã –≤ —Ü–µ–ª–µ–≤–æ–π —Å—Ç–æ–ª–±–µ—Ü
                    gameState.tableau[targetIndex] = gameState.tableau[targetIndex].concat(cards);
                    
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                    if (gameState.tableau[sourceIndex].length > 0) {
                        const topCard = gameState.tableau[sourceIndex][gameState.tableau[sourceIndex].length - 1];
                        if (!topCard.isFaceUp) {
                            topCard.isFaceUp = true;
                        }
                    }
                    
                    moved = true;
                }
            } else if (sourceType === 'tableau' && targetType === 'foundation') {
                // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ –≤ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç (—Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–∞—Ä—Ç—É)
                if (cards.length === 1) {
                    const card = cards[0];
                    
                    if (gameState.foundations[targetIndex].length === 0 && card.value === 'A') {
                        const movedCard = gameState.tableau[sourceIndex].pop();
                        gameState.foundations[targetIndex].push(movedCard);
                        
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç—É –≤ —Å—Ç–æ–ª–±—Ü–µ, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                        if (gameState.tableau[sourceIndex].length > 0) {
                            const topCard = gameState.tableau[sourceIndex][gameState.tableau[sourceIndex].length - 1];
                            if (!topCard.isFaceUp) {
                                topCard.isFaceUp = true;
                            }
                        }
                        
                        moved = true;
                    } else if (gameState.foundations[targetIndex].length > 0) {
                        const topFoundationCard = gameState.foundations[targetIndex][gameState.foundations[targetIndex].length - 1];
                        if (topFoundationCard.suit === card.suit && 
                            getCardValue(card.value) === getCardValue(topFoundationCard.value) + 1) {
                            const movedCard = gameState.tableau[sourceIndex].pop();
                            gameState.foundations[targetIndex].push(movedCard);
                            
                            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç—É –≤ —Å—Ç–æ–ª–±—Ü–µ, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                            if (gameState.tableau[sourceIndex].length > 0) {
                                const topCard = gameState.tableau[sourceIndex][gameState.tableau[sourceIndex].length - 1];
                                if (!topCard.isFaceUp) {
                                    topCard.isFaceUp = true;
                                }
                            }
                            
                            moved = true;
                        }
                    }
                }
            } else if (sourceType === 'waste' && targetType === 'tableau') {
                // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–∑ —Å–±—Ä–æ—Å–∞ –≤ —Å—Ç–æ–ª–±–µ—Ü (—Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–∞—Ä—Ç—É)
                const card = cards[0];
                
                if (gameState.tableau[targetIndex].length === 0 && card.value === 'K') {
                    const movedCard = gameState.waste.pop();
                    gameState.tableau[targetIndex].push(movedCard);
                    moved = true;
                } else if (gameState.tableau[targetIndex].length > 0) {
                    const topTableauCard = gameState.tableau[targetIndex][gameState.tableau[targetIndex].length - 1];
                    if (topTableauCard.color !== card.color && 
                        getCardValue(card.value) === getCardValue(topTableauCard.value) - 1) {
                        const movedCard = gameState.waste.pop();
                        gameState.tableau[targetIndex].push(movedCard);
                        moved = true;
                    }
                }
            } else if (sourceType === 'waste' && targetType === 'foundation') {
                // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–∑ —Å–±—Ä–æ—Å–∞ –≤ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç (—Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∫–∞—Ä—Ç—É)
                const card = cards[0];
                
                if (gameState.foundations[targetIndex].length === 0 && card.value === 'A') {
                    const movedCard = gameState.waste.pop();
                    gameState.foundations[targetIndex].push(movedCard);
                    moved = true;
                } else if (gameState.foundations[targetIndex].length > 0) {
                    const topFoundationCard = gameState.foundations[targetIndex][gameState.foundations[targetIndex].length - 1];
                    if (topFoundationCard.suit === card.suit && 
                        getCardValue(card.value) === getCardValue(topFoundationCard.value) + 1) {
                        const movedCard = gameState.waste.pop();
                        gameState.foundations[targetIndex].push(movedCard);
                        moved = true;
                    }
                }
            }
            
            if (moved) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                updateTableView();
                updateWasteView();
                updateFoundationsView();
                updateStockView();
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ö–æ–¥–æ–≤
                gameState.moves++;
                movesCountElement.textContent = gameState.moves;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã
                checkWinCondition();
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã
        function checkWinCondition() {
            let allFoundationsFull = true;
            
            for (const foundation of gameState.foundations) {
                if (foundation.length !== 13) {
                    allFoundationsFull = false;
                    break;
                }
            }
            
            if (allFoundationsFull) {
                gameStatusElement.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!';
                gameStatusElement.classList.add('win');
                clearInterval(gameState.timerInterval);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startTimer() {
            clearInterval(gameState.timerInterval);
            
            gameState.timerInterval = setInterval(() => {
                const elapsedSeconds = Math.floor((Date.now() - gameState.startTime) / 1000);
                timeElement.textContent = elapsedSeconds;
            }, 1000);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function addEventListeners() {
            newGameButton.addEventListener('click', initGame);
            
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleTheme() {
            if (gameState.theme === 'light') {
                gameState.theme = 'dark';
                body.classList.add('dark-theme');
                themeToggle.innerHTML = '<span class="theme-icon">üåì</span> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            } else {
                gameState.theme = 'light';
                body.classList.remove('dark-theme');
                themeToggle.innerHTML = '<span class="theme-icon">üåì</span> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', initGame);
    </script>
</body>
</html>